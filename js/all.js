function addMovieToTrending(){const e=document.getElementById("poster-watch-movie");if(!e)return;const t=e.style.backgroundImage.match(/url\((['"]?)(.*?)\1\)/);if(!t)return;const n=t[2],o=document.querySelector('link[rel="canonical"]');if(!o)return;const s="film/"+o.getAttribute("href"),i={poster:n,path:s,title:s.split("/").pop().replace(/-/g," ").replace(".html","")};let a=JSON.parse(localStorage.getItem("trendingMovies"))||[];a.some((e=>e.path===i.path))||(a.unshift(i),a.length>20&&a.pop(),localStorage.setItem("trendingMovies",JSON.stringify(a)))}function displayRecentlyWatchedMovies(){const e=JSON.parse(localStorage.getItem("trendingMovies"))||[],t=document.querySelector(".video-shows-section.vfx-item-ptb"),n=document.getElementById("recently-watched");0!==e.length?(t&&(t.style.display="block"),n&&(n.innerHTML="",e.forEach((e=>{const t=document.createElement("div");t.classList.add("single-video"),t.innerHTML=`\n            <a href="${e.path}" title="${e.title}">\n                <div class="video-img">\n                    <span class="video-item-content">${e.title}</span>\n                    <img src="${e.poster}" alt="${e.title}" title="Movies-${e.title}">\n                </div>\n            </a>\n        `,n.appendChild(t)})),$(document).ready((function(){$(".owl-carousel").owlCarousel({nav:!0,margin:20,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2},640:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:6,slideBy:6}}})})))):t&&(t.style.display="none")}async function showSuggestions(e){const t=document.getElementById("search_output");if(t.innerHTML="",e)try{const n=await fetch("../search/d.json");if(!n.ok)throw new Error("Erreur réseau");const o=await n.json(),s=normalizeString(e),i=o.filter((e=>normalizeString(e.nom).includes(s))).slice(0,48);i.length>0?i.forEach((e=>{const n=document.createElement("div");n.classList.add("single-video"),n.innerHTML=`\n                    <a href="${e.emplacement}">\n                        <div class="video-img">\n                            <span class="video-item-content">${e.nom}</span>\n                            <img src="${e.affiche}" alt="${e.nom}">\n                        </div>\n                    </a>\n                `,t.appendChild(n)})):t.innerHTML="<p>Aucun résultat trouvé.</p>"}catch(e){t.innerHTML="<p>Une erreur est survenue lors du chargement des données.</p>",console.error("Erreur de recherche:",e)}}function normalizeString(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/['’]/g,"").replace(/-/g," ").trim()}function toggleWatchlist(e,t,n,o){const s={nom:t,affiche:n,emplacement:o},i=JSON.parse(localStorage.getItem("watchlist"))||[],a=i.findIndex((e=>e.nom===t));-1===a?(i.push(s),localStorage.setItem("watchlist",JSON.stringify(i)),e.innerHTML='<i class="fa fa-check"></i>‎ Supprimer de ma liste',e.onclick=()=>toggleWatchlist(e,t,n,o)):(i.splice(a,1),localStorage.setItem("watchlist",JSON.stringify(i)),e.innerHTML='<i class="fa fa-plus"></i>‎ Ajouter à ma liste',e.onclick=()=>toggleWatchlist(e,t,n,o))}function isInWebIntoApp(){var e=navigator.userAgent||navigator.vendor||window.opera;return/wv/.test(e)}document.addEventListener("DOMContentLoaded",(()=>{const e=window.innerWidth>=600,t=new Plyr("#player",{controls:e?["play-large","rewind","play","fast-forward","progress","current-time","mute","volume","settings","captions","pip","airplay","fullscreen"]:["play-large","rewind","play","fast-forward","progress","current-time","settings","captions","pip","airplay","fullscreen"],settings:["captions","quality","speed"],playsinline:!0,keyboard:{focused:!0,global:!0},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"player"},invertTime:!1,disableContextMenu:!0,ratio:"16:9",i18n:{restart:"Recommencer",rewind:"Revenir de {seektime}s",play:"Lecture",pause:"Pause",fastForward:"Avancer de {seektime}s",seek:"Rechercher",seekLabel:"{currentTime} de {duration}",played:"Lancé",buffered:"Mis en mémoire",currentTime:"Temps actuel",duration:"Durée",volume:"Volume",mute:"Silence",unmute:"Son activé",enableCaptions:"Activer les sous-titres",disableCaptions:"Désactiver les sous-titres",download:"Télécharger",enterFullscreen:"Plein écran",exitFullscreen:"Sortir du plein écran",frameTitle:"Lecteur pour {title}",captions:"Sous-titres",settings:"Réglages",pip:"Picture-In-Picture",menuBack:"Retour au menu précédent",speed:"Vitesse",normal:"Normal",quality:"Qualité",loop:"Boucle",start:"Début",end:"Fin",all:"Tous",reset:"Réinitialiser",disabled:"Désactivé",enabled:"Activé",advertisement:"Publicité"},volume:1,muted:!1}),n=document.getElementById("player"),o=document.getElementById("video-loader"),s=n.querySelector("source").src,i=`videoCurrentTime_${encodeURIComponent(s)}`;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||t.on("ready",(()=>{const e=document.querySelector(".plyr__controls");if(!e)return;const t=e.querySelector('[data-plyr="pip"]');if(t){const e=document.createElement("button");e.classList.add("plyr__control"),e.id="castButton",e.innerHTML='\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100">\n                    <path d="M447.8 64H64c-23.6 0-42.7 19.1-42.7 42.7v63.9H64v-63.9h383.8v298.6H298.6V448H448c23.6 0 42.7-19.1 42.7-42.7V106.7C490.7 83.1 471.4 64 447.8 64zM21.3 383.6L21.3 383.6l0 63.9h63.9C85.2 412.2 56.6 383.6 21.3 383.6L21.3 383.6zM21.3 298.6V341c58.9 0 106.6 48.1 106.6 107h42.7C170.7 365.6 103.7 298.7 21.3 298.6zM213.4 448h42.7c-.5-129.5-105.3-234.3-234.8-234.6l0 42.4C127.3 255.6 213.3 342 213.4 448z" fill="white"/>\n                </svg>\n            ',t.insertAdjacentElement("afterend",e);const n=document.getElementById("castButton");n?n.addEventListener("click",(()=>{const e=cast.framework.CastContext.getInstance();e.getCastState()||e.setOptions(castOptions);const t=e.getCastState();t===cast.framework.CastState.CONNECTING||t===cast.framework.CastState.CONNECTED?l():e.requestSession()})):console.error("Le bouton Cast n'a pas été trouvé.")}}));const a=()=>{const e=localStorage.getItem(i);e&&(n.currentTime=parseFloat(e))},r=e=>{o.style.display=e?"block":"none"};if(r(!1),n.addEventListener("pause",(()=>{r(!1)})),n.addEventListener("play",(()=>{r(!0)})),Hls.isSupported()){const e=new Hls;e.loadSource(s),e.attachMedia(n),e.on(Hls.Events.MANIFEST_PARSED,(()=>r(!1))),e.on(Hls.Events.BUFFER_STALLED,(()=>r(!0))),n.addEventListener("timeupdate",(()=>{localStorage.setItem(i,n.currentTime)})),n.addEventListener("waiting",(()=>r(!0))),n.addEventListener("playing",(()=>r(!1))),a()}else n.canPlayType("application/vnd.apple.mpegurl")?(n.src=s,n.addEventListener("loadeddata",(()=>r(!1))),n.addEventListener("waiting",(()=>r(!0))),n.addEventListener("timeupdate",(()=>{localStorage.setItem(i,n.currentTime)})),a()):(console.error("HLS non supporté, ou aucun fallback compatible disponible."),r(!1));function l(){const e=cast.framework.CastContext.getInstance().getCurrentSession();if(e){const t=document.querySelector("#player source"),n=t?t.src:null;if(n){const t=new chrome.cast.media.MediaInfo(n,"application/x-mpegURL");t.metadata=new chrome.cast.media.GenericMediaMetadata,t.metadata.title="CAST | Crimson";const o=new chrome.cast.media.LoadRequest(t);e.loadMedia(o).then((()=>console.log("Vidéo diffusée avec succès."))).catch((e=>console.error("Erreur de diffusion :",e)))}}}window.__onGCastApiAvailable=function(e){e?function(){if("undefined"==typeof cast||!cast.framework)return void console.error("Google Cast Framework non disponible.");const e=cast.framework.CastContext.getInstance();e.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(e=>{e.sessionState!==cast.framework.SessionState.SESSION_STARTED&&e.sessionState!==cast.framework.SessionState.SESSION_RESUMED||l()}))}():console.error("API Google Cast non disponible.")}})),document.querySelector("#regarder").addEventListener("click",(function(e){var t=document.querySelector("#player");t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((function(){t&&"undefined"!=typeof Plyr?new Plyr(t).play().catch((e=>{console.error("Erreur lors de la tentative de lecture automatique :",e)})):console.error("Le lecteur Plyr n’est pas détecté ou n’a pas été initialisé correctement.")}),500)})),document.addEventListener("DOMContentLoaded",(async function(){try{const e=document.title,t=/Regarder\s(.+?)\sen\sstreaming/,n=e.match(t);if(!n||!n[1])return void console.error("Impossible d'extraire le nom du film depuis le titre HTML.");const o=n[1].trim();console.log("Nom du film extrait :",o);const s=await fetch("../search/data.json"),i=await s.json(),a=await fetch("../search/f.json"),r=await a.json(),l=i.find((e=>e.nom===o));if(!l)return void console.error("Film introuvable dans data.json :",o);const c=l.genre.split(",").map((e=>e.trim()));console.log("Genres du film :",c);const d=i.filter((e=>e.nom!==o)).map((e=>{const t=e.genre.split(",").map((e=>e.trim())).filter((e=>c.includes(e)));return{...e,commonGenresCount:t.length}})).filter((e=>e.commonGenresCount>0)).sort(((e,t)=>t.commonGenresCount-e.commonGenresCount)).slice(0,10);console.log("Films recommandés :",d);const m=d.map((e=>{const t=r.find((t=>t.nom===e.nom));return{...e,emplacement:t?t.emplacement.split("/").pop():null}})).filter((e=>e.emplacement));console.log("Films avec emplacements :",m);const u=document.getElementById("suggestions-carousel");if(!u)return void console.error("Le conteneur du carousel n'a pas été trouvé.");m.forEach((e=>{const t=`\n                <div class="item">\n                    <div class="single-video">\n                        <a href="${e.emplacement}" title="${e.nom}">\n                            <div class="video-img"> \n                                <span class="video-item-content">${e.nom}</span>\n                                <img src="${e.affiche}" alt="${e.nom}" title="${e.nom}">         \n                            </div>       \n                        </a>\n                    </div>\n                </div>`;u.innerHTML+=t})),$(".owl-carousel").owlCarousel({loop:!1,margin:10,nav:!0,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2,margin:15},480:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:7,slideBy:7}}})}catch(e){console.error("Erreur lors du traitement :",e)}})),document.addEventListener("DOMContentLoaded",displayRecentlyWatchedMovies),document.getElementById("poster-watch-movie")&&addMovieToTrending(),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("2222"),t=document.getElementById("video-popup"),n=(document.querySelector(".popup-rectangle"),document.getElementById("youtube-player"));e.addEventListener("click",(()=>{const o=e.getAttribute("data-video");o?(t.style.display="flex",t.classList.remove("closing"),setTimeout((()=>{t.classList.add("active"),n.src=`${o}?autoplay=1`,n.style.opacity="1"}),10)):console.error("Aucune URL de vidéo spécifiée dans l'attribut data-video !")})),t.addEventListener("click",(()=>{n.style.opacity="0",n.src="",t.classList.remove("active"),t.classList.add("closing"),setTimeout((()=>{t.style.display="none",t.classList.remove("closing")}),400)}))})),isInWebIntoApp()&&setTimeout((function(){window.location.href="https://crimson-streaming.github.io/crimson/pages/déinstallation.html"}),2e3),isInWebIntoApp()&&(window.location.href="intent://crimson-streaming.github.io/crimson/pages/déinstallation.html#Intent;scheme=https;package=com.android.chrome;end"),document.addEventListener("DOMContentLoaded",(function(){if(window.self!==window.top){const e=document.createElement("div");e.style.position="fixed",e.style.top="-30px",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.backgroundColor="#0d0620",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="9999",e.style.textAlign="center",e.style.color="#333";const t=document.createElement("style");t.innerHTML="\n            @keyframes pulse {\n                0% {\n                    transform: scale(1);\n                }\n                50% {\n                    transform: scale(1.1);\n                }\n                100% {\n                    transform: scale(1);\n                }\n            }\n            .pulse-animation {\n                animation: pulse 1s infinite;\n            }\n        ",document.head.appendChild(t),e.innerHTML='\n            <img src="https://crimson-streaming.github.io/crimson/img/logo.png" alt="Logo Crimson" style="width: 200px; margin-bottom: 50px;">\n            <h1 style="font-size: 24px;color: #fff;"><b>Vous naviguez sur une copie de Crimson ⚠️</b></h1>\n            <p style="font-size: 18px; margin: 20px 0; color: #fff;">\n                Crimson est uniquement disponible sur ce site \n            </p>\n            <a href="https://crimson-streaming.github.io/crimson/" target="_blank" class="pulse-animation" style="background-color: #b81b0e; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-decoration: none; margin: 5px; display: inline-block;">\n                Accéder au site Crimson\n            </a>\n\n        ',document.body.appendChild(e)}}));