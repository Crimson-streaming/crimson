async function showSuggestions(e){const t=document.getElementById("search_output");if(t.innerHTML="",e)try{const n=await fetch("../search/d.json");if(!n.ok)throw new Error("Erreur réseau");const s=await n.json(),i=normalizeString(e),o=s.filter(e=>normalizeString(e.nom).includes(i)).slice(0,48);o.length>0?o.forEach(e=>{const n=document.createElement("div");n.classList.add("single-video"),n.innerHTML=`\n                    <a href="${e.emplacement}">\n                        <div class="video-img">\n                            <span class="video-item-content">${e.nom}</span>\n                            <img src="${e.affiche}" alt="${e.nom}">\n                        </div>\n                    </a>\n                `,t.appendChild(n)}):t.innerHTML="<p>Aucun résultat trouvé.</p>"}catch(e){t.innerHTML="<p>Une erreur est survenue lors du chargement des données.</p>",console.error("Erreur de recherche:",e)}}function normalizeString(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/['’]/g,"").replace(/-/g," ").trim()}function isInWebIntoApp(){var e=navigator.userAgent||navigator.vendor||window.opera;return/wv/.test(e)}document.addEventListener("DOMContentLoaded",()=>{const e=window.innerWidth>=600,t=new Plyr("#player",{controls:e?["play-large","rewind","play","fast-forward","progress","current-time","mute","volume","settings","captions","pip","airplay","fullscreen"]:["play-large","rewind","play","fast-forward","progress","current-time","settings","captions","pip","airplay","fullscreen"],settings:["captions","quality","speed"],playsinline:!0,keyboard:{focused:!0,global:!0},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"player"},invertTime:!1,disableContextMenu:!0,ratio:"16:9",i18n:{restart:"Recommencer",rewind:"Revenir de {seektime}s",play:"Lecture",pause:"Pause",fastForward:"Avancer de {seektime}s",seek:"Rechercher",seekLabel:"{currentTime} de {duration}",played:"Lancé",buffered:"Mis en mémoire",currentTime:"Temps actuel",duration:"Durée",volume:"Volume",mute:"Silence",unmute:"Son activé",enableCaptions:"Activer les sous-titres",disableCaptions:"Désactiver les sous-titres",download:"Télécharger",enterFullscreen:"Plein écran",exitFullscreen:"Sortir du plein écran",frameTitle:"Lecteur pour {title}",captions:"Sous-titres",settings:"Réglages",pip:"Picture-In-Picture",menuBack:"Retour au menu précédent",speed:"Vitesse",normal:"Normal",quality:"Qualité",loop:"Boucle",start:"Début",end:"Fin",all:"Tous",reset:"Réinitialiser",disabled:"Désactivé",enabled:"Activé",advertisement:"Publicité"},volume:1,muted:!1}),n=document.getElementById("player"),s=document.getElementById("video-loader"),i=n.querySelector("source").src,o=`videoCurrentTime_${encodeURIComponent(i)}`;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||t.on("ready",()=>{const e=document.querySelector(".plyr__controls");if(!e)return;const t=document.createElement("button");t.classList.add("plyr__control"),t.id="castButton",t.innerHTML='\n             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100">\n                 <path d="M447.8 64H64c-23.6 0-42.7 19.1-42.7 42.7v63.9H64v-63.9h383.8v298.6H298.6V448H448c23.6 0 42.7-19.1 42.7-42.7V106.7C490.7 83.1 471.4 64 447.8 64zM21.3 383.6L21.3 383.6l0 63.9h63.9C85.2 412.2 56.6 383.6 21.3 383.6L21.3 383.6zM21.3 298.6V341c58.9 0 106.6 48.1 106.6 107h42.7C170.7 365.6 103.7 298.7 21.3 298.6zM213.4 448h42.7c-.5-129.5-105.3-234.3-234.8-234.6l0 42.4C127.3 255.6 213.3 342 213.4 448z" fill="white"/>\n             </svg>\n          ',e.appendChild(t);const n=document.getElementById("castButton");n?n.addEventListener("click",()=>{const e=cast.framework.CastContext.getInstance().getCastState();e===cast.framework.CastState.CONNECTING||e===cast.framework.CastState.CONNECTED?l():cast.framework.CastContext.getInstance().requestSession()}):console.error("Le bouton Cast n'a pas été trouvé.")});const a=()=>{const e=localStorage.getItem(o);e&&(n.currentTime=parseFloat(e))},r=e=>{s.style.display=e?"block":"none"};if(r(!1),n.addEventListener("pause",()=>{r(!1)}),n.addEventListener("play",()=>{r(!0)}),Hls.isSupported()){const e=new Hls;e.loadSource(i),e.attachMedia(n),e.on(Hls.Events.MANIFEST_PARSED,()=>r(!1)),e.on(Hls.Events.BUFFER_STALLED,()=>r(!0)),n.addEventListener("timeupdate",()=>{localStorage.setItem(o,n.currentTime)}),n.addEventListener("waiting",()=>r(!0)),n.addEventListener("playing",()=>r(!1)),a()}else n.canPlayType("application/vnd.apple.mpegurl")?(n.src=i,n.addEventListener("loadeddata",()=>r(!1)),n.addEventListener("waiting",()=>r(!0)),n.addEventListener("timeupdate",()=>{localStorage.setItem(o,n.currentTime)}),a()):(console.error("HLS non supporté, ou aucun fallback compatible disponible."),r(!1));function l(){const e=cast.framework.CastContext.getInstance().getCurrentSession();if(e){const t=document.querySelector("#player source"),n=t?t.src:null;if(n){const t=new chrome.cast.media.MediaInfo(n,"application/x-mpegURL");t.metadata=new chrome.cast.media.GenericMediaMetadata,t.metadata.title="CAST | Crimson";const s=new chrome.cast.media.LoadRequest(t);e.loadMedia(s).then(()=>console.log("Vidéo diffusée avec succès.")).catch(e=>console.error("Erreur de diffusion :",e))}}}window.__onGCastApiAvailable=function(e){e?function(){if("undefined"==typeof cast||!cast.framework)return void console.error("Google Cast Framework non disponible.");const e=cast.framework.CastContext.getInstance();e.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,e=>{e.sessionState!==cast.framework.SessionState.SESSION_STARTED&&e.sessionState!==cast.framework.SessionState.SESSION_RESUMED||l()})}():console.error("API Google Cast non disponible.")}}),isInWebIntoApp()&&setTimeout(function(){window.location.href="https://crimson-streaming.github.io/crimson/pages/déinstallation.html"},2e3),isInWebIntoApp()&&(window.location.href="intent://crimson-streaming.github.io/crimson/pages/déinstallation.html#Intent;scheme=https;package=com.android.chrome;end"),document.addEventListener("DOMContentLoaded",function(){if(window.self!==window.top){const e=document.createElement("div");e.style.position="fixed",e.style.top="-30px",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.backgroundColor="#0d0620",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="9999",e.style.textAlign="center",e.style.color="#333";const t=document.createElement("style");t.innerHTML="\n            @keyframes pulse {\n                0% {\n                    transform: scale(1);\n                }\n                50% {\n                    transform: scale(1.1);\n                }\n                100% {\n                    transform: scale(1);\n                }\n            }\n            .pulse-animation {\n                animation: pulse 1s infinite;\n            }\n        ",document.head.appendChild(t),e.innerHTML='\n            <img src="https://crimson-streaming.github.io/crimson/img/logo.png" alt="Logo Crimson" style="width: 200px; margin-bottom: 50px;">\n            <h1 style="font-size: 24px;color: #fff;"><b>Vous naviguez sur une copie de Crimson ⚠️</b></h1>\n            <p style="font-size: 18px; margin: 20px 0; color: #fff;">\n                Crimson est uniquement disponible sur ce site \n            </p>\n            <a href="https://crimson-streaming.github.io/crimson/" target="_blank" class="pulse-animation" style="background-color: #b81b0e; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-decoration: none; margin: 5px; display: inline-block;">\n                Accéder au site Crimson\n            </a>\n\n        ',document.body.appendChild(e)}});const itemsPerPage=48;let currentPage=1;function loadWatchlist(){let e=JSON.parse(localStorage.getItem("watchlist"))||[];e.reverse(),renderFilms(e,currentPage),renderPagination(e)}function renderFilms(e,t){const n=(t-1)*itemsPerPage,s=n+itemsPerPage,i=e.slice(n,s),o=document.getElementById("movies-container");o.innerHTML="",i.length>0?i.forEach((e,t)=>{const s=document.createElement("div");s.classList.add("col-lg-2","col-md-3","col-sm-4","col-xs-12","col-6","single-video"),s.innerHTML=`\n                <div class="watchlist-item">\n                    <a href="#" title="Remove" onclick="removeFromWatchlist(${n+t})">\n                        <i class="fa fa-times"></i> Retirer\n                    </a>\n                </div>\n                <a href="${e.emplacement}" title="${e.nom}">\n                    <div class="video-img">\n                        <span class="video-item-content">${e.nom}</span>\n                        <img src="${e.affiche}" alt="${e.nom}" title="${e.nom}">\n                    </div>\n                </a>\n            `,o.appendChild(s)}):o.innerHTML="<p>Aucun film dans votre liste pour le moment.</p>"}function renderPagination(e){const t=Math.ceil(e.length/itemsPerPage),n=document.getElementById("pagination-links");n.innerHTML="";let s=Math.max(1,currentPage-Math.floor(5.5)),i=Math.min(t,s+11-1);if(i-s<10&&(s=Math.max(1,i-11+1)),t>1){n.innerHTML+=`\n            <li class="${1===currentPage?"disabled":""}">\n                <a class="prev page-numbers" href="#" onclick="changePage(${currentPage-1})"><i class="fa fa-caret-left"></i></a>\n            </li>\n        `;for(let e=s;e<=i;e++)n.innerHTML+=`\n                <li class="${e===currentPage?"active":""}">\n                    <a class="page-numbers" href="#" onclick="changePage(${e})">${e}</a>\n                </li>\n            `;n.innerHTML+=`\n            <li class="${currentPage===t?"disabled":""}">\n                <a class="next page-numbers" href="#" onclick="changePage(${currentPage+1})"><i class="fa fa-caret-right"></i></a>\n            </li>\n        `}}function changePage(e){const t=JSON.parse(localStorage.getItem("watchlist"))||[],n=Math.ceil(t.length/itemsPerPage);e<1||e>n||(renderFilms(t,currentPage=e),renderPagination(t))}function showCustomAlert(e){const t=document.createElement("div");t.classList.add("custom-alert"),t.innerHTML=`\n        <img src="img/assets/icon-sweetalert.png" alt="Success" class="icon">\n        ${e}\n    `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}function removeFromWatchlist(e){let t=JSON.parse(localStorage.getItem("watchlist"))||[];const n=t.length-1-e;t.splice(n,1);localStorage.setItem("watchlist",JSON.stringify(t)),loadWatchlist(),showCustomAlert("Supprimé avec succès de votre liste")}function toggleWatchlist(e,t,n,s){const i={nom:t,affiche:n,emplacement:s},o=JSON.parse(localStorage.getItem("watchlist"))||[],a=o.findIndex(e=>e.nom===t);-1===a?(o.push(i),localStorage.setItem("watchlist",JSON.stringify(o)),e.innerHTML='<i class="fa fa-check"></i>‎ Supprimer de ma liste',e.onclick=(()=>toggleWatchlist(e,t,n,s))):(o.splice(a,1),localStorage.setItem("watchlist",JSON.stringify(o)),e.innerHTML='<i class="fa fa-plus"></i>‎ Ajouter à ma liste',e.onclick=(()=>toggleWatchlist(e,t,n,s)))}function addMovieToTrending(){const e=document.getElementById("poster-watch-movie");if(!e)return;const t=e.style.backgroundImage.match(/url\((['"]?)(.*?)\1\)/);if(!t)return;const n=t[2],s=document.querySelector('link[rel="canonical"]');if(!s)return;const i="film/"+s.getAttribute("href"),o={poster:n,path:i,title:i.split("/").pop().replace(/-/g," ").replace(".html","")};let a=JSON.parse(localStorage.getItem("trendingMovies"))||[];a.some(e=>e.path===o.path)||(a.unshift(o),a.length>20&&a.pop(),localStorage.setItem("trendingMovies",JSON.stringify(a)))}function displayRecentlyWatchedMovies(){const e=JSON.parse(localStorage.getItem("trendingMovies"))||[],t=document.querySelector(".video-shows-section.vfx-item-ptb"),n=document.getElementById("recently-watched");0!==e.length?(t&&(t.style.display="block"),n&&(n.innerHTML="",e.forEach(e=>{const t=document.createElement("div");t.classList.add("single-video"),t.innerHTML=`\n            <a href="${e.path}" title="${e.title}">\n                <div class="video-img">\n                    <span class="video-item-content">${e.title}</span>\n                    <img src="${e.poster}" alt="${e.title}" title="Movies-${e.title}">\n                </div>\n            </a>\n        `,n.appendChild(t)}),$(document).ready(function(){$(".owl-carousel").owlCarousel({nav:!0,margin:20,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2,margin:15},640:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:6,slideBy:6}}})}))):t&&(t.style.display="none")}window.onload=loadWatchlist,$(document).bind("contextmenu",function(){return!1}),$(document).ready(function(){$(".video-shows-carousel").owlCarousel({loop:!1,margin:10,nav:!0,dots:!0,navText:["<i class='fas fa-angle-left'></i>","<i class='fas fa-angle-right'></i>"],responsive:{0:{items:1},600:{items:2},1000:{items:""}}})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("2222"),t=document.getElementById("video-popup"),n=(document.querySelector(".popup-rectangle"),document.getElementById("youtube-player"));e.addEventListener("click",()=>{const s=e.getAttribute("data-video");s?(t.style.display="flex",t.classList.remove("closing"),setTimeout(()=>{t.classList.add("active"),n.src=`${s}?autoplay=1`,n.style.opacity="1"},10)):console.error("Aucune URL de vidéo spécifiée dans l'attribut data-video !")}),t.addEventListener("click",()=>{n.style.opacity="0",n.src="",t.classList.remove("active"),t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},400)})}),document.addEventListener("DOMContentLoaded",async function(){try{const e=document.title,t=/Regarder\s(.+?)\sen\sstreaming/,n=e.match(t);if(!n||!n[1])return void console.error("Impossible d'extraire le nom du film depuis le titre HTML.");const s=n[1].trim();console.log("Nom du film extrait :",s);const i=await fetch("../search/data.json"),o=await i.json(),a=await fetch("../search/f.json"),r=await a.json(),l=o.find(e=>e.nom===s);if(!l)return void console.error("Film introuvable dans data.json :",s);const c=l.genre.split(",").map(e=>e.trim());console.log("Genres du film :",c);const d=o.filter(e=>e.nom!==s).map(e=>{return{...e,commonGenresCount:e.genre.split(",").map(e=>e.trim()).filter(e=>c.includes(e)).length}}).filter(e=>e.commonGenresCount>0).sort((e,t)=>t.commonGenresCount-e.commonGenresCount).slice(0,10);console.log("Films recommandés :",d);const m=d.map(e=>{const t=r.find(t=>t.nom===e.nom);return{...e,emplacement:t?t.emplacement.split("/").pop():null}}).filter(e=>e.emplacement);console.log("Films avec emplacements :",m);const u=document.getElementById("suggestions-carousel");if(!u)return void console.error("Le conteneur du carousel n'a pas été trouvé.");m.forEach(e=>{const t=`\n                <div class="item">\n                    <div class="single-video">\n                        <a href="${e.emplacement}" title="${e.nom}">\n                            <div class="video-img"> \n                                <span class="video-item-content">${e.nom}</span>\n                                <img src="${e.affiche}" alt="${e.nom}" title="${e.nom}">         \n                            </div>       \n                        </a>\n                    </div>\n                </div>`;u.innerHTML+=t}),$(".owl-carousel").owlCarousel({loop:!1,margin:10,nav:!0,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2,margin:15},480:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:7,slideBy:7}}})}catch(e){console.error("Erreur lors du traitement :",e)}}),document.addEventListener("DOMContentLoaded",displayRecentlyWatchedMovies),document.getElementById("poster-watch-movie")&&addMovieToTrending();