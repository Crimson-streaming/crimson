async function showSuggestions(e){const t=document.getElementById("search_output");if(t.innerHTML="",e)try{const n=await fetch("../search/d.json");if(!n.ok)throw new Error("Erreur réseau");const a=await n.json(),o=normalizeString(e),i=a.filter((e=>normalizeString(e.nom).includes(o))).slice(0,48);i.length>0?i.forEach((e=>{const n=document.createElement("div");n.classList.add("single-video"),n.innerHTML=`\n                    <a href="${e.emplacement}">\n                        <div class="video-img">\n                            <span class="video-item-content">${e.nom}</span>\n                            <img src="${e.affiche}" alt="${e.nom}">\n                        </div>\n                    </a>\n                `,t.appendChild(n)})):t.innerHTML="<p>Aucun résultat trouvé.</p>"}catch(e){t.innerHTML="<p>Une erreur est survenue lors du chargement des données.</p>",console.error("Erreur de recherche:",e)}}function normalizeString(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/['’]/g,"").replace(/-/g," ").trim()}function isInWebIntoApp(){var e=navigator.userAgent||navigator.vendor||window.opera;return/wv/.test(e)}function gtag(){dataLayer.push(arguments)}document.addEventListener("DOMContentLoaded",(()=>{const e=window.innerWidth>=600,t=new Plyr("#player",{controls:e?["play-large","rewind","play","fast-forward","progress","current-time","mute","volume","settings","captions","pip","airplay","fullscreen"]:["play-large","rewind","play","fast-forward","progress","current-time","settings","captions","pip","airplay","fullscreen"],settings:["captions","quality","speed"],playsinline:!0,keyboard:{focused:!0,global:!0},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"player"},invertTime:!1,disableContextMenu:!0,ratio:"16:9",i18n:{restart:"Recommencer",rewind:"Revenir de {seektime}s",play:"Lecture",pause:"Pause",fastForward:"Avancer de {seektime}s",seek:"Rechercher",seekLabel:"{currentTime} de {duration}",played:"Lancé",buffered:"Mis en mémoire",currentTime:"Temps actuel",duration:"Durée",volume:"Volume",mute:"Silence",unmute:"Son activé",enableCaptions:"Activer les sous-titres",disableCaptions:"Désactiver les sous-titres",download:"Télécharger",enterFullscreen:"Plein écran",exitFullscreen:"Sortir du plein écran",frameTitle:"Lecteur pour {title}",captions:"Sous-titres",settings:"Réglages",pip:"Picture-In-Picture",menuBack:"Retour au menu précédent",speed:"Vitesse",normal:"Normal",quality:"Qualité",loop:"Boucle",start:"Début",end:"Fin",all:"Tous",reset:"Réinitialiser",disabled:"Désactivé",enabled:"Activé",advertisement:"Publicité"},volume:1,muted:!1}),n=document.getElementById("player"),a=document.getElementById("video-loader"),o=n.querySelector("source").src,i=`videoCurrentTime_${encodeURIComponent(o)}`;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||t.on("ready",(()=>{const e=document.querySelector(".plyr__controls");if(!e)return;const t=e.querySelector('[data-plyr="pip"]');if(t){const e=document.createElement("button");e.classList.add("plyr__control"),e.id="castButton",e.innerHTML='\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100">\n                    <path d="M447.8 64H64c-23.6 0-42.7 19.1-42.7 42.7v63.9H64v-63.9h383.8v298.6H298.6V448H448c23.6 0 42.7-19.1 42.7-42.7V106.7C490.7 83.1 471.4 64 447.8 64zM21.3 383.6L21.3 383.6l0 63.9h63.9C85.2 412.2 56.6 383.6 21.3 383.6L21.3 383.6zM21.3 298.6V341c58.9 0 106.6 48.1 106.6 107h42.7C170.7 365.6 103.7 298.7 21.3 298.6zM213.4 448h42.7c-.5-129.5-105.3-234.3-234.8-234.6l0 42.4C127.3 255.6 213.3 342 213.4 448z" fill="white"/>\n                </svg>\n            ',t.insertAdjacentElement("afterend",e);const n=document.getElementById("castButton");n?n.addEventListener("click",(()=>{const e=cast.framework.CastContext.getInstance();e.getCastState()||e.setOptions(castOptions);const t=e.getCastState();t===cast.framework.CastState.CONNECTING||t===cast.framework.CastState.CONNECTED?c():e.requestSession()})):console.error("Le bouton Cast n'a pas été trouvé.")}}));const r=()=>{const e=localStorage.getItem(i);e&&(n.currentTime=parseFloat(e))},s=e=>{a.style.display=e?"block":"none"};if(s(!1),n.addEventListener("pause",(()=>{s(!1)})),n.addEventListener("play",(()=>{s(!0)})),Hls.isSupported()){const e=new Hls;e.loadSource(o),e.attachMedia(n),e.on(Hls.Events.MANIFEST_PARSED,(()=>s(!1))),e.on(Hls.Events.BUFFER_STALLED,(()=>s(!0))),n.addEventListener("timeupdate",(()=>{localStorage.setItem(i,n.currentTime)})),n.addEventListener("waiting",(()=>s(!0))),n.addEventListener("playing",(()=>s(!1))),r()}else n.canPlayType("application/vnd.apple.mpegurl")?(n.src=o,n.addEventListener("loadeddata",(()=>s(!1))),n.addEventListener("waiting",(()=>s(!0))),n.addEventListener("timeupdate",(()=>{localStorage.setItem(i,n.currentTime)})),r()):(console.error("HLS non supporté, ou aucun fallback compatible disponible."),s(!1));function c(){const e=cast.framework.CastContext.getInstance().getCurrentSession();if(e){const t=document.querySelector("#player source"),n=t?t.src:null;if(n){const t=new chrome.cast.media.MediaInfo(n,"application/x-mpegURL");t.metadata=new chrome.cast.media.GenericMediaMetadata,t.metadata.title="CAST | Crimson";const a=new chrome.cast.media.LoadRequest(t);e.loadMedia(a).then((()=>console.log("Vidéo diffusée avec succès."))).catch((e=>console.error("Erreur de diffusion :",e)))}}}window.__onGCastApiAvailable=function(e){e?function(){if("undefined"==typeof cast||!cast.framework)return void console.error("Google Cast Framework non disponible.");const e=cast.framework.CastContext.getInstance();e.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(e=>{e.sessionState!==cast.framework.SessionState.SESSION_STARTED&&e.sessionState!==cast.framework.SessionState.SESSION_RESUMED||c()}))}():console.error("API Google Cast non disponible.")}})),isInWebIntoApp()&&setTimeout((function(){window.location.href="https://crimson-streaming.github.io/crimson/pages/déinstallation.html"}),2e3),isInWebIntoApp()&&(window.location.href="intent://crimson-streaming.github.io/crimson/pages/déinstallation.html#Intent;scheme=https;package=com.android.chrome;end"),document.addEventListener("DOMContentLoaded",(function(){if(window.self!==window.top){const e=document.createElement("div");e.style.position="fixed",e.style.top="-30px",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.backgroundColor="#0d0620",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="9999",e.style.textAlign="center",e.style.color="#333";const t=document.createElement("style");t.innerHTML="\n            @keyframes pulse {\n                0% {\n                    transform: scale(1);\n                }\n                50% {\n                    transform: scale(1.1);\n                }\n                100% {\n                    transform: scale(1);\n                }\n            }\n            .pulse-animation {\n                animation: pulse 1s infinite;\n            }\n        ",document.head.appendChild(t),e.innerHTML='\n            <img src="https://crimson-streaming.github.io/crimson/img/logo.png" alt="Logo Crimson" style="width: 200px; margin-bottom: 50px;">\n            <h1 style="font-size: 24px;color: #fff;"><b>Vous naviguez sur une copie de Crimson ⚠️</b></h1>\n            <p style="font-size: 18px; margin: 20px 0; color: #fff;">\n                Crimson est uniquement disponible sur ce site \n            </p>\n            <a href="https://crimson-streaming.github.io/crimson/" target="_blank" class="pulse-animation" style="background-color: #b81b0e; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-decoration: none; margin: 5px; display: inline-block;">\n                Accéder au site Crimson\n            </a>\n\n        ',document.body.appendChild(e)}})),window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7QZGKN17QX");const itemsPerPage=48;let currentPage=1;function loadWatchlist(){let e=JSON.parse(localStorage.getItem("watchlist"))||[];e.reverse(),renderFilms(e,currentPage),renderPagination(e)}function renderFilms(e,t){const n=48*(t-1),a=n+48,o=e.slice(n,a),i=document.getElementById("movies-container");i.innerHTML="",o.length>0?o.forEach(((e,t)=>{const a=document.createElement("div");a.classList.add("col-lg-2","col-md-3","col-sm-4","col-xs-12","col-6","single-video"),a.innerHTML=`\n                <div class="watchlist-item">\n                    <a href="#" title="Remove" onclick="removeFromWatchlist(${n+t})">\n                        <i class="fa fa-times"></i> Retirer\n                    </a>\n                </div>\n                <a href="${e.emplacement}" title="${e.nom}">\n                    <div class="video-img">\n                        <span class="video-item-content">${e.nom}</span>\n                        <img src="${e.affiche}" alt="${e.nom}" title="${e.nom}">\n                    </div>\n                </a>\n            `,i.appendChild(a)})):i.innerHTML="<p>Aucun film dans votre liste pour le moment.</p>"}function renderPagination(e){const t=Math.ceil(e.length/48),n=document.getElementById("pagination-links");n.innerHTML="";let a=Math.max(1,currentPage-Math.floor(5.5)),o=Math.min(t,a+11-1);if(o-a<10&&(a=Math.max(1,o-11+1)),t>1){n.innerHTML+=`\n            <li class="${1===currentPage?"disabled":""}">\n                <a class="prev page-numbers" href="#" onclick="changePage(${currentPage-1})"><i class="fa fa-caret-left"></i></a>\n            </li>\n        `;for(let e=a;e<=o;e++)n.innerHTML+=`\n                <li class="${e===currentPage?"active":""}">\n                    <a class="page-numbers" href="#" onclick="changePage(${e})">${e}</a>\n                </li>\n            `;n.innerHTML+=`\n            <li class="${currentPage===t?"disabled":""}">\n                <a class="next page-numbers" href="#" onclick="changePage(${currentPage+1})"><i class="fa fa-caret-right"></i></a>\n            </li>\n        `}}function changePage(e){const t=JSON.parse(localStorage.getItem("watchlist"))||[],n=Math.ceil(t.length/48);e<1||e>n||(currentPage=e,renderFilms(t,currentPage),renderPagination(t))}function showCustomAlert(e){const t=document.createElement("div");t.classList.add("custom-alert"),t.innerHTML=`\n        <img src="img/assets/icon-sweetalert.png" alt="Success" class="icon">\n        ${e}\n    `,document.body.appendChild(t),setTimeout((()=>{t.remove()}),3e3)}function removeFromWatchlist(e){let t=JSON.parse(localStorage.getItem("watchlist"))||[];const n=t.length-1-e;t.splice(n,1);localStorage.setItem("watchlist",JSON.stringify(t)),loadWatchlist(),showCustomAlert("Supprimé avec succès de votre liste")}function toggleWatchlist(e,t,n,a){const o={nom:t,affiche:n,emplacement:a},i=JSON.parse(localStorage.getItem("watchlist"))||[],r=i.findIndex((e=>e.nom===t));-1===r?(i.push(o),localStorage.setItem("watchlist",JSON.stringify(i)),e.innerHTML='<i class="fa fa-check"></i>‎ Supprimer de ma liste',e.onclick=()=>toggleWatchlist(e,t,n,a)):(i.splice(r,1),localStorage.setItem("watchlist",JSON.stringify(i)),e.innerHTML='<i class="fa fa-plus"></i>‎ Ajouter à ma liste',e.onclick=()=>toggleWatchlist(e,t,n,a))}window.onload=loadWatchlist,$(document).bind("contextmenu",(function(){return!1})),document.querySelector("#regarder").addEventListener("click",(function(e){var t=document.querySelector("#player");t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((function(){t&&"undefined"!=typeof Plyr?new Plyr(t).play().catch((e=>{console.error("Erreur lors de la tentative de lecture automatique :",e)})):console.error("Le lecteur Plyr n’est pas détecté ou n’a pas été initialisé correctement.")}),500)}));