document.addEventListener("DOMContentLoaded",()=>{const r=window.innerWidth>=600?["play-large","rewind","play","fast-forward","progress","current-time","mute","volume","settings","captions","pip","airplay","fullscreen"]:["play-large","rewind","play","fast-forward","progress","current-time","settings","captions","pip","airplay","fullscreen"],l=new Plyr("#player",{controls:r,settings:["captions","quality","speed"],playsinline:!0,keyboard:{focused:!0,global:!0},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"player"},invertTime:!1,disableContextMenu:!0,ratio:"16:9",i18n:{restart:"Recommencer",rewind:"Revenir de {seektime}s",play:"Lecture",pause:"Pause",fastForward:"Avancer de {seektime}s",seek:"Rechercher",seekLabel:"{currentTime} de {duration}",played:"Lanc\xE9",buffered:"Mis en m\xE9moire",currentTime:"Temps actuel",duration:"Dur\xE9e",volume:"Volume",mute:"Silence",unmute:"Son activ\xE9",enableCaptions:"Activer les sous-titres",disableCaptions:"D\xE9sactiver les sous-titres",download:"T\xE9l\xE9charger",enterFullscreen:"Plein \xE9cran",exitFullscreen:"Sortir du plein \xE9cran",frameTitle:"Lecteur pour {title}",captions:"Sous-titres",settings:"R\xE9glages",pip:"Picture-In-Picture",menuBack:"Retour au menu pr\xE9c\xE9dent",speed:"Vitesse",normal:"Normal",quality:"Qualit\xE9",loop:"Boucle",start:"D\xE9but",end:"Fin",all:"Tous",reset:"R\xE9initialiser",disabled:"D\xE9sactiv\xE9",enabled:"Activ\xE9",advertisement:"Publicit\xE9"},volume:1,muted:!1}),t=document.getElementById("player"),S=document.getElementById("video-loader"),d=t.querySelector("source").src,u=`videoCurrentTime_${encodeURIComponent(d)}`;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||l.on("ready",()=>{const e=document.querySelector(".plyr__controls");if(!e)return;const a=e.querySelector('[data-plyr="pip"]');if(a){const s=document.createElement("button");s.classList.add("plyr__control"),s.id="castButton",s.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100">
                    <path d="M447.8 64H64c-23.6 0-42.7 19.1-42.7 42.7v63.9H64v-63.9h383.8v298.6H298.6V448H448c23.6 0 42.7-19.1 42.7-42.7V106.7C490.7 83.1 471.4 64 447.8 64zM21.3 383.6L21.3 383.6l0 63.9h63.9C85.2 412.2 56.6 383.6 21.3 383.6L21.3 383.6zM21.3 298.6V341c58.9 0 106.6 48.1 106.6 107h42.7C170.7 365.6 103.7 298.7 21.3 298.6zM213.4 448h42.7c-.5-129.5-105.3-234.3-234.8-234.6l0 42.4C127.3 255.6 213.3 342 213.4 448z" fill="white"/>
                </svg>
            `,a.insertAdjacentElement("afterend",s);const i=document.getElementById("castButton");i?i.addEventListener("click",()=>{const o=cast.framework.CastContext.getInstance();o.getCastState()||o.setOptions(castOptions);const c=o.getCastState();c===cast.framework.CastState.CONNECTING||c===cast.framework.CastState.CONNECTED?p():o.requestSession()}):console.error("Le bouton Cast n'a pas \xE9t\xE9 trouv\xE9.")}});const m=()=>{const e=localStorage.getItem(u);e&&(t.currentTime=parseFloat(e))},n=e=>{S.style.display=e?"block":"none"};if(n(!1),t.addEventListener("pause",()=>{n(!1)}),t.addEventListener("play",()=>{n(!0)}),Hls.isSupported()){const e=new Hls;e.loadSource(d),e.attachMedia(t),e.on(Hls.Events.MANIFEST_PARSED,()=>n(!1)),e.on(Hls.Events.BUFFER_STALLED,()=>n(!0)),t.addEventListener("timeupdate",()=>{localStorage.setItem(u,t.currentTime)}),t.addEventListener("waiting",()=>n(!0)),t.addEventListener("playing",()=>n(!1)),m()}else t.canPlayType("application/vnd.apple.mpegurl")?(t.src=d,t.addEventListener("loadeddata",()=>n(!1)),t.addEventListener("waiting",()=>n(!0)),t.addEventListener("timeupdate",()=>{localStorage.setItem(u,t.currentTime)}),m()):(console.error("HLS non support\xE9, ou aucun fallback compatible disponible."),n(!1));function y(){if(typeof cast>"u"||!cast.framework){console.error("Google Cast Framework non disponible.");return}const e=cast.framework.CastContext.getInstance();e.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,a=>{(a.sessionState===cast.framework.SessionState.SESSION_STARTED||a.sessionState===cast.framework.SessionState.SESSION_RESUMED)&&p()})}function p(){const a=cast.framework.CastContext.getInstance().getCurrentSession();if(a){const s=document.querySelector("#player source"),i=s?s.src:null;if(i){const o=new chrome.cast.media.MediaInfo(i,"application/x-mpegURL");o.metadata=new chrome.cast.media.GenericMediaMetadata,o.metadata.title="CAST | Crimson";const c=new chrome.cast.media.LoadRequest(o);a.loadMedia(c).then(()=>console.log("Vid\xE9o diffus\xE9e avec succ\xE8s.")).catch(g=>console.error("Erreur de diffusion :",g))}}}window.__onGCastApiAvailable=function(e){e?y():console.error("API Google Cast non disponible.")}}),document.querySelector("#regarder").addEventListener("click",function(f){var r=document.querySelector("#player");r.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(function(){if(r&&typeof Plyr<"u"){var l=new Plyr(r);l.play().catch(t=>{console.error("Erreur lors de la tentative de lecture automatique :",t)})}else console.error("Le lecteur Plyr n\u2019est pas d\xE9tect\xE9 ou n\u2019a pas \xE9t\xE9 initialis\xE9 correctement.")},500)});
