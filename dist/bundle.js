(()=>{document.addEventListener("DOMContentLoaded",()=>{let t="ontouchstart"in window||/Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent),i=window.innerWidth>=600&&!t?["play-large","rewind","play","fast-forward","progress","current-time","mute","volume","settings","captions","pip","airplay","fullscreen"]:["play-large","rewind","play","fast-forward","progress","current-time","settings","captions","pip","airplay","fullscreen"];console.log("Contr\xF4les du lecteur :",i);let s=new Plyr("#player",{controls:i,settings:["captions","quality","speed"],playsinline:!0,keyboard:{focused:!0,global:!0},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"player"},invertTime:!1,disableContextMenu:!0,ratio:"16:9",i18n:{restart:"Recommencer",rewind:"Revenir de {seektime}s",play:"Lecture",pause:"Pause",fastForward:"Avancer de {seektime}s",seek:"Rechercher",seekLabel:"{currentTime} de {duration}",played:"Lanc\xE9",buffered:"Mis en m\xE9moire",currentTime:"Temps actuel",duration:"Dur\xE9e",volume:"Volume",mute:"Silence",unmute:"Son activ\xE9",enableCaptions:"Activer les sous-titres",disableCaptions:"D\xE9sactiver les sous-titres",download:"T\xE9l\xE9charger",enterFullscreen:"Plein \xE9cran",exitFullscreen:"Sortir du plein \xE9cran",frameTitle:"Lecteur pour {title}",captions:"Sous-titres",settings:"R\xE9glages",pip:"Picture-In-Picture",menuBack:"Retour au menu pr\xE9c\xE9dent",speed:"Vitesse",normal:"Normal",quality:"Qualit\xE9",loop:"Boucle",start:"D\xE9but",end:"Fin",all:"Tous",reset:"R\xE9initialiser",disabled:"D\xE9sactiv\xE9",enabled:"Activ\xE9",advertisement:"Publicit\xE9"},volume:1,muted:!1}),n=document.getElementById("player"),g=document.getElementById("video-loader"),m=n.querySelector("source").src,p=`videoCurrentTime_${encodeURIComponent(m)}`;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||s.on("ready",()=>{let e=document.querySelector(".plyr__controls");if(!e)return;let r=e.querySelector('[data-plyr="pip"]');if(r){let c=document.createElement("button");c.classList.add("plyr__control"),c.id="castButton",c.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100">
                    <path d="M447.8 64H64c-23.6 0-42.7 19.1-42.7 42.7v63.9H64v-63.9h383.8v298.6H298.6V448H448c23.6 0 42.7-19.1 42.7-42.7V106.7C490.7 83.1 471.4 64 447.8 64zM21.3 383.6L21.3 383.6l0 63.9h63.9C85.2 412.2 56.6 383.6 21.3 383.6L21.3 383.6zM21.3 298.6V341c58.9 0 106.6 48.1 106.6 107h42.7C170.7 365.6 103.7 298.7 21.3 298.6zM213.4 448h42.7c-.5-129.5-105.3-234.3-234.8-234.6l0 42.4C127.3 255.6 213.3 342 213.4 448z" fill="white"/>
                </svg>
            `,r.insertAdjacentElement("afterend",c);let d=document.getElementById("castButton");d?d.addEventListener("click",()=>{let u=cast.framework.CastContext.getInstance();u.getCastState()||u.setOptions(castOptions);let h=u.getCastState();h===cast.framework.CastState.CONNECTING||h===cast.framework.CastState.CONNECTED?y():u.requestSession()}):console.error("Le bouton Cast n'a pas \xE9t\xE9 trouv\xE9.")}});let l=()=>{let e=localStorage.getItem(p);e&&(n.currentTime=parseFloat(e))},a=e=>{g.style.display=e?"block":"none"};if(a(!1),n.addEventListener("pause",()=>{a(!1)}),n.addEventListener("play",()=>{a(!0)}),Hls.isSupported()){let e=new Hls;e.loadSource(m),e.attachMedia(n),e.on(Hls.Events.MANIFEST_PARSED,()=>a(!1)),e.on(Hls.Events.BUFFER_STALLED,()=>a(!0)),n.addEventListener("timeupdate",()=>{localStorage.setItem(p,n.currentTime)}),n.addEventListener("waiting",()=>a(!0)),n.addEventListener("playing",()=>a(!1)),l()}else n.canPlayType("application/vnd.apple.mpegurl")?(n.src=m,n.addEventListener("loadeddata",()=>a(!1)),n.addEventListener("waiting",()=>a(!0)),n.addEventListener("timeupdate",()=>{localStorage.setItem(p,n.currentTime)}),l()):(console.error("HLS non support\xE9, ou aucun fallback compatible disponible."),a(!1));function v(){if(typeof cast>"u"||!cast.framework){console.error("Google Cast Framework non disponible.");return}let e=cast.framework.CastContext.getInstance();e.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,r=>{(r.sessionState===cast.framework.SessionState.SESSION_STARTED||r.sessionState===cast.framework.SessionState.SESSION_RESUMED)&&y()})}function y(){let r=cast.framework.CastContext.getInstance().getCurrentSession();if(r){let c=document.querySelector("#player source"),d=c?c.src:null;if(d){let u=new chrome.cast.media.MediaInfo(d,"application/x-mpegURL");u.metadata=new chrome.cast.media.GenericMediaMetadata,u.metadata.title="CAST | Crimson";let h=new chrome.cast.media.LoadRequest(u);r.loadMedia(h).then(()=>console.log("Vid\xE9o diffus\xE9e avec succ\xE8s.")).catch(E=>console.error("Erreur de diffusion :",E))}}}window.__onGCastApiAvailable=function(e){e?v():console.error("API Google Cast non disponible.")}});document.querySelector("#regarder").addEventListener("click",function(t){var o=document.querySelector("#player");o.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(function(){if(o&&typeof Plyr<"u"){var i=new Plyr(o);i.play().catch(s=>{console.error("Erreur lors de la tentative de lecture automatique :",s)})}else console.error("Le lecteur Plyr n\u2019est pas d\xE9tect\xE9 ou n\u2019a pas \xE9t\xE9 initialis\xE9 correctement.")},500)});function C(){let t=document.getElementById("poster-watch-movie");if(!t)return;let i=t.style.backgroundImage.match(/url\((['"]?)(.*?)\1\)/);if(!i)return;let s=i[2],n=document.querySelector('link[rel="canonical"]');if(!n)return;let g="film/"+n.getAttribute("href"),m=document.querySelector(".dtl-title-block h1");if(!m)return;let p=m.textContent.trim(),f={poster:s,path:g,title:p},l=JSON.parse(localStorage.getItem("trendingMovies"))||[];l.some(a=>a.path===f.path)||(l.unshift(f),l.length>20&&l.pop(),localStorage.setItem("trendingMovies",JSON.stringify(l)))}function S(){let t=JSON.parse(localStorage.getItem("trendingMovies"))||[],o=document.querySelector(".video-shows-section.vfx-item-ptb"),i=document.getElementById("recently-watched");!i||!o||(o.style.display=t.length>0?"block":"none",i.innerHTML="",t.forEach(s=>{let n=document.createElement("div");n.classList.add("single-video"),n.innerHTML=`
            <a href="${s.path}" title="${s.title}">
                <div class="video-img">
                    <span class="video-item-content">${s.title}</span>
                    <img src="${s.poster}" alt="${s.title}" title="Movies-${s.title}">
                </div>
            </a>
        `,i.appendChild(n)}),$(document).ready(function(){$(".owl-carousel").owlCarousel({nav:!0,margin:20,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2},640:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:6,slideBy:6}}})}))}document.addEventListener("DOMContentLoaded",S);document.getElementById("poster-watch-movie")&&C();document.addEventListener("DOMContentLoaded",async function(){try{let t=document.title,o=/Regarder\s(.+?)\sen\sstreaming/,i=t.match(o);if(!i||!i[1]){console.error("Impossible d'extraire le nom du film depuis le titre HTML.");return}let s=i[1].trim();console.log("Nom du film extrait :",s);let g=await(await fetch("../search/data.json")).json(),p=await(await fetch("../search/f.json")).json(),f=g.find(e=>e.nom===s);if(!f){console.error("Film introuvable dans data.json :",s);return}let l=f.genre.split(",").map(e=>e.trim());console.log("Genres du film :",l);let a=g.filter(e=>e.nom!==s).map(e=>{let c=e.genre.split(",").map(d=>d.trim()).filter(d=>l.includes(d));return{...e,commonGenresCount:c.length}}).filter(e=>e.commonGenresCount>0).sort((e,r)=>r.commonGenresCount-e.commonGenresCount).slice(0,10);console.log("Films recommand\xE9s :",a);let v=a.map(e=>{let r=p.find(c=>c.nom===e.nom);return{...e,emplacement:r?r.emplacement.split("/").pop():null}}).filter(e=>e.emplacement);console.log("Films avec emplacements :",v);let y=document.getElementById("suggestions-carousel");if(!y){console.error("Le conteneur du carousel n'a pas \xE9t\xE9 trouv\xE9.");return}v.forEach(e=>{let r=`
                <div class="item">
                    <div class="single-video">
                        <a href="${e.emplacement}" title="${e.nom}">
                            <div class="video-img"> 
                                <span class="video-item-content">${e.nom}</span>
                                <img src="${e.affiche}" alt="${e.nom}" title="${e.nom}">         
                            </div>       
                        </a>
                    </div>
                </div>`;y.innerHTML+=r}),$(".owl-carousel").owlCarousel({loop:!1,margin:10,nav:!0,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2,margin:15},480:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:7,slideBy:7}}})}catch(t){console.error("Erreur lors du traitement :",t)}});document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("2222"),o=document.getElementById("video-popup"),i=document.querySelector(".popup-rectangle"),s=document.getElementById("youtube-player");t.addEventListener("click",()=>{let n=t.getAttribute("data-video");if(!n){console.error("Aucune URL de vid\xE9o sp\xE9cifi\xE9e dans l'attribut data-video !");return}o.style.display="flex",o.classList.remove("closing"),setTimeout(()=>{o.classList.add("active"),s.src=`${n}?autoplay=1`,s.style.opacity="1"},10)}),o.addEventListener("click",()=>{s.style.opacity="0",s.src="",o.classList.remove("active"),o.classList.add("closing"),setTimeout(()=>{o.style.display="none",o.classList.remove("closing")},400)})});function w(){var t=navigator.userAgent||navigator.vendor||window.opera;return/wv/.test(t)}w()&&setTimeout(function(){window.location.href="https://crimson-streaming.github.io/crimson/pages/d\xE9installation.html"},2e3);w()&&(window.location.href="intent://crimson-streaming.github.io/crimson/pages/d\xE9installation.html#Intent;scheme=https;package=com.android.chrome;end");document.addEventListener("DOMContentLoaded",function(){if(window.self!==window.top){let t=document.createElement("div");t.style.position="fixed",t.style.top="-30px",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.backgroundColor="#0d0620",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="9999",t.style.textAlign="center",t.style.color="#333";let o=document.createElement("style");o.innerHTML=`
            @keyframes pulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                }
            }
            .pulse-animation {
                animation: pulse 1s infinite;
            }
        `,document.head.appendChild(o),t.innerHTML=`
            <img src="https://crimson-streaming.github.io/crimson/img/logo.png" alt="Logo Crimson" style="width: 200px; margin-bottom: 50px;">
            <h1 style="font-size: 24px;color: #fff;"><b>Vous naviguez sur une copie de Crimson \u26A0\uFE0F</b></h1>
            <p style="font-size: 18px; margin: 20px 0; color: #fff;">
                Crimson est uniquement disponible sur ce site 
            </p>
            <a href="https://crimson-streaming.github.io/crimson/" target="_blank" class="pulse-animation" style="background-color: #b81b0e; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-decoration: none; margin: 5px; display: inline-block;">
                Acc\xE9der au site Crimson
            </a>

        `,document.body.appendChild(t)}});console.log("Tous les scripts sont charg\xE9s !");})();
