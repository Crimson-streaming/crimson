(()=>{document.addEventListener("DOMContentLoaded",()=>{let o=window.innerWidth>=600?["play-large","rewind","play","fast-forward","progress","current-time","mute","volume","settings","captions","pip","airplay","fullscreen"]:["play-large","rewind","play","fast-forward","progress","current-time","settings","captions","pip","airplay","fullscreen"],i=new Plyr("#player",{controls:o,settings:["captions","quality","speed"],playsinline:!0,keyboard:{focused:!0,global:!0},fullscreen:{enabled:!0,fallback:!0,iosNative:!0},storage:{enabled:!0,key:"player"},invertTime:!1,disableContextMenu:!0,ratio:"16:9",i18n:{restart:"Recommencer",rewind:"Revenir de {seektime}s",play:"Lecture",pause:"Pause",fastForward:"Avancer de {seektime}s",seek:"Rechercher",seekLabel:"{currentTime} de {duration}",played:"Lanc\xE9",buffered:"Mis en m\xE9moire",currentTime:"Temps actuel",duration:"Dur\xE9e",volume:"Volume",mute:"Silence",unmute:"Son activ\xE9",enableCaptions:"Activer les sous-titres",disableCaptions:"D\xE9sactiver les sous-titres",download:"T\xE9l\xE9charger",enterFullscreen:"Plein \xE9cran",exitFullscreen:"Sortir du plein \xE9cran",frameTitle:"Lecteur pour {title}",captions:"Sous-titres",settings:"R\xE9glages",pip:"Picture-In-Picture",menuBack:"Retour au menu pr\xE9c\xE9dent",speed:"Vitesse",normal:"Normal",quality:"Qualit\xE9",loop:"Boucle",start:"D\xE9but",end:"Fin",all:"Tous",reset:"R\xE9initialiser",disabled:"D\xE9sactiv\xE9",enabled:"Activ\xE9",advertisement:"Publicit\xE9"},volume:1,muted:!1}),e=document.getElementById("player"),l=document.getElementById("video-loader"),d=e.querySelector("source").src,p=`videoCurrentTime_${encodeURIComponent(d)}`;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||i.on("ready",()=>{let s=document.querySelector(".plyr__controls");if(!s)return;let t=s.querySelector('[data-plyr="pip"]');if(t){let r=document.createElement("button");r.classList.add("plyr__control"),r.id="castButton",r.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100">
                    <path d="M447.8 64H64c-23.6 0-42.7 19.1-42.7 42.7v63.9H64v-63.9h383.8v298.6H298.6V448H448c23.6 0 42.7-19.1 42.7-42.7V106.7C490.7 83.1 471.4 64 447.8 64zM21.3 383.6L21.3 383.6l0 63.9h63.9C85.2 412.2 56.6 383.6 21.3 383.6L21.3 383.6zM21.3 298.6V341c58.9 0 106.6 48.1 106.6 107h42.7C170.7 365.6 103.7 298.7 21.3 298.6zM213.4 448h42.7c-.5-129.5-105.3-234.3-234.8-234.6l0 42.4C127.3 255.6 213.3 342 213.4 448z" fill="white"/>
                </svg>
            `,t.insertAdjacentElement("afterend",r);let m=document.getElementById("castButton");m?m.addEventListener("click",()=>{let c=cast.framework.CastContext.getInstance();c.getCastState()||c.setOptions(castOptions);let v=c.getCastState();v===cast.framework.CastState.CONNECTING||v===cast.framework.CastState.CONNECTED?g():c.requestSession()}):console.error("Le bouton Cast n'a pas \xE9t\xE9 trouv\xE9.")}});let f=()=>{let s=localStorage.getItem(p);s&&(e.currentTime=parseFloat(s))},a=s=>{l.style.display=s?"block":"none"};if(a(!1),e.addEventListener("pause",()=>{a(!1)}),e.addEventListener("play",()=>{a(!0)}),Hls.isSupported()){let s=new Hls;s.loadSource(d),s.attachMedia(e),s.on(Hls.Events.MANIFEST_PARSED,()=>a(!1)),s.on(Hls.Events.BUFFER_STALLED,()=>a(!0)),e.addEventListener("timeupdate",()=>{localStorage.setItem(p,e.currentTime)}),e.addEventListener("waiting",()=>a(!0)),e.addEventListener("playing",()=>a(!1)),f()}else e.canPlayType("application/vnd.apple.mpegurl")?(e.src=d,e.addEventListener("loadeddata",()=>a(!1)),e.addEventListener("waiting",()=>a(!0)),e.addEventListener("timeupdate",()=>{localStorage.setItem(p,e.currentTime)}),f()):(console.error("HLS non support\xE9, ou aucun fallback compatible disponible."),a(!1));function y(){if(typeof cast>"u"||!cast.framework){console.error("Google Cast Framework non disponible.");return}let s=cast.framework.CastContext.getInstance();s.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),s.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,t=>{(t.sessionState===cast.framework.SessionState.SESSION_STARTED||t.sessionState===cast.framework.SessionState.SESSION_RESUMED)&&g()})}function g(){let t=cast.framework.CastContext.getInstance().getCurrentSession();if(t){let r=document.querySelector("#player source"),m=r?r.src:null;if(m){let c=new chrome.cast.media.MediaInfo(m,"application/x-mpegURL");c.metadata=new chrome.cast.media.GenericMediaMetadata,c.metadata.title="CAST | Crimson";let v=new chrome.cast.media.LoadRequest(c);t.loadMedia(v).then(()=>console.log("Vid\xE9o diffus\xE9e avec succ\xE8s.")).catch(E=>console.error("Erreur de diffusion :",E))}}}window.__onGCastApiAvailable=function(s){s?y():console.error("API Google Cast non disponible.")}});document.querySelector("#regarder").addEventListener("click",function(n){var o=document.querySelector("#player");o.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(function(){if(o&&typeof Plyr<"u"){var i=new Plyr(o);i.play().catch(e=>{console.error("Erreur lors de la tentative de lecture automatique :",e)})}else console.error("Le lecteur Plyr n\u2019est pas d\xE9tect\xE9 ou n\u2019a pas \xE9t\xE9 initialis\xE9 correctement.")},500)});function w(){let n=document.getElementById("poster-watch-movie");if(!n)return;let i=n.style.backgroundImage.match(/url\((['"]?)(.*?)\1\)/);if(!i)return;let e=i[2],l=document.querySelector('link[rel="canonical"]');if(!l)return;let d="film/"+l.getAttribute("href"),p={poster:e,path:d,title:d.split("/").pop().replace(/-/g," ").replace(".html","")},u=JSON.parse(localStorage.getItem("trendingMovies"))||[];u.some(f=>f.path===p.path)||(u.unshift(p),u.length>20&&u.pop(),localStorage.setItem("trendingMovies",JSON.stringify(u)))}function S(){let n=JSON.parse(localStorage.getItem("trendingMovies"))||[],o=document.querySelector(".video-shows-section.vfx-item-ptb"),i=document.getElementById("recently-watched");if(n.length===0){o&&(o.style.display="none");return}else o&&(o.style.display="block");i&&(i.innerHTML="",n.forEach(e=>{let l=document.createElement("div");l.classList.add("single-video"),l.innerHTML=`
            <a href="${e.path}" title="${e.title}">
                <div class="video-img">
                    <span class="video-item-content">${e.title}</span>
                    <img src="${e.poster}" alt="${e.title}" title="Movies-${e.title}">
                </div>
            </a>
        `,i.appendChild(l)}),$(document).ready(function(){$(".owl-carousel").owlCarousel({nav:!0,margin:20,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2},640:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:6,slideBy:6}}})}))}document.addEventListener("DOMContentLoaded",S);document.getElementById("poster-watch-movie")&&w();document.addEventListener("DOMContentLoaded",async function(){try{let n=document.title,o=/Regarder\s(.+?)\sen\sstreaming/,i=n.match(o);if(!i||!i[1]){console.error("Impossible d'extraire le nom du film depuis le titre HTML.");return}let e=i[1].trim();console.log("Nom du film extrait :",e);let d=await(await fetch("../search/data.json")).json(),u=await(await fetch("../search/f.json")).json(),f=d.find(t=>t.nom===e);if(!f){console.error("Film introuvable dans data.json :",e);return}let a=f.genre.split(",").map(t=>t.trim());console.log("Genres du film :",a);let y=d.filter(t=>t.nom!==e).map(t=>{let m=t.genre.split(",").map(c=>c.trim()).filter(c=>a.includes(c));return{...t,commonGenresCount:m.length}}).filter(t=>t.commonGenresCount>0).sort((t,r)=>r.commonGenresCount-t.commonGenresCount).slice(0,10);console.log("Films recommand\xE9s :",y);let g=y.map(t=>{let r=u.find(m=>m.nom===t.nom);return{...t,emplacement:r?r.emplacement.split("/").pop():null}}).filter(t=>t.emplacement);console.log("Films avec emplacements :",g);let s=document.getElementById("suggestions-carousel");if(!s){console.error("Le conteneur du carousel n'a pas \xE9t\xE9 trouv\xE9.");return}g.forEach(t=>{let r=`
                <div class="item">
                    <div class="single-video">
                        <a href="${t.emplacement}" title="${t.nom}">
                            <div class="video-img"> 
                                <span class="video-item-content">${t.nom}</span>
                                <img src="${t.affiche}" alt="${t.nom}" title="${t.nom}">         
                            </div>       
                        </a>
                    </div>
                </div>`;s.innerHTML+=r}),$(".owl-carousel").owlCarousel({loop:!1,margin:10,nav:!0,navText:['<i class="fas fa-angle-left"></i>','<i class="fas fa-angle-right"></i>'],responsive:{0:{items:2,slideBy:2,margin:15},480:{items:3,slideBy:3},768:{items:4,slideBy:4},991:{items:5,slideBy:5},1198:{items:7,slideBy:7}}})}catch(n){console.error("Erreur lors du traitement :",n)}});document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("2222"),o=document.getElementById("video-popup"),i=document.querySelector(".popup-rectangle"),e=document.getElementById("youtube-player");n.addEventListener("click",()=>{let l=n.getAttribute("data-video");if(!l){console.error("Aucune URL de vid\xE9o sp\xE9cifi\xE9e dans l'attribut data-video !");return}o.style.display="flex",o.classList.remove("closing"),setTimeout(()=>{o.classList.add("active"),e.src=`${l}?autoplay=1`,e.style.opacity="1"},10)}),o.addEventListener("click",()=>{e.style.opacity="0",e.src="",o.classList.remove("active"),o.classList.add("closing"),setTimeout(()=>{o.style.display="none",o.classList.remove("closing")},400)})});function h(){var n=navigator.userAgent||navigator.vendor||window.opera;return/wv/.test(n)}h()&&setTimeout(function(){window.location.href="https://crimson-streaming.github.io/crimson/pages/d\xE9installation.html"},2e3);h()&&(window.location.href="intent://crimson-streaming.github.io/crimson/pages/d\xE9installation.html#Intent;scheme=https;package=com.android.chrome;end");document.addEventListener("DOMContentLoaded",function(){if(window.self!==window.top){let n=document.createElement("div");n.style.position="fixed",n.style.top="-30px",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.backgroundColor="#0d0620",n.style.display="flex",n.style.flexDirection="column",n.style.justifyContent="center",n.style.alignItems="center",n.style.zIndex="9999",n.style.textAlign="center",n.style.color="#333";let o=document.createElement("style");o.innerHTML=`
            @keyframes pulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                }
            }
            .pulse-animation {
                animation: pulse 1s infinite;
            }
        `,document.head.appendChild(o),n.innerHTML=`
            <img src="https://crimson-streaming.github.io/crimson/img/logo.png" alt="Logo Crimson" style="width: 200px; margin-bottom: 50px;">
            <h1 style="font-size: 24px;color: #fff;"><b>Vous naviguez sur une copie de Crimson \u26A0\uFE0F</b></h1>
            <p style="font-size: 18px; margin: 20px 0; color: #fff;">
                Crimson est uniquement disponible sur ce site 
            </p>
            <a href="https://crimson-streaming.github.io/crimson/" target="_blank" class="pulse-animation" style="background-color: #b81b0e; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-decoration: none; margin: 5px; display: inline-block;">
                Acc\xE9der au site Crimson
            </a>

        `,document.body.appendChild(n)}});console.log("Tous les scripts sont charg\xE9s !");})();
